accelerator:
  displayName: Hello World
  description: "Hello World Accelerator"
  iconUrl: https://raw.githubusercontent.com/simple-starters/icons/master/icon-tanzu-light.png
  tags: ["spring", "java", "web", "rest"]

  options:
  #
  # UI option to get the package name for the generated java code
  #
  - name: packageName
    label: Package name
    dataType: string
    required: true
    defaultValue: "com.acme"
    description: Name of the package to put generated code under

  #
  # UI option to get java version to use
  #
  - name: javaVersion
    label: Java version to use
    inputType: select
    defaultValue: "11"
    choices:
    - value: "11"
      text: "Java 11"
    - value: "17"
      text: "Java 17"
    description: Select java version to use

  #
  # UI option to optionally generate K8s deployment files
  #
  - name: generateK8sYAMLS
    label: Generate K8s YAML for this project
    inputType: checkbox
    dataType: boolean
    defaultValue: false

## Added engine section that does the transforms. Here we are using chain transform with include filter of all folders and files. 
## We then add exclude filter to ensure resulting output files won't include files.
engine:
# Changed from chain to merge. Chain works sequentially, takes output of previous step as input for next. Last filter only included
# pom.xml. Merge akes the outputs of several transforms executed independently on the same input sourceset and combines or merges 
# them together into a single sourceset.
  merge: 
  - include: [ "**/**" ]
    exclude: [ "options.json", "run.sh","acc-engine-endpoint.sh","src/main/java/com/example/**"]
  # I want to change "helloworld" in pom.xml to "projectName" value and include all files from include filter above.
  # But wait, I only get pom.xml as output. I want all the files as well....
  - include: [ "pom.xml" ]
    chain:
      - type: ReplaceText
        substitutions:
          - text: "helloworld"
            with: "#projectName"
      # Chain multiple transforms to work on same set of file(s). Change packageName and Java version.
      - type: ReplaceText
        substitutions:
          - text: "com.example"
            with: "#packageName"
      - type: ReplaceText
        condition: "#javaVersion == '17'"
        substitutions:
          - text: <java.version>11</java.version>
            with: "'<java.version>17</java.version>'"

  #
  # Added third include filter for all java files. Invoking OpenRewrite recipe to change package to match packageName entered.
  #
  - include: ["**/*.java"]
    chain:
      - type: OpenRewriteRecipe
        recipe: org.openrewrite.java.ChangePackage
        options:
          oldPackageName: "'com.example'"
          newPackageName: "#packageName"
      - exclude: ["src/main/java/com/example/**"]

  # 
  # Generate the K8s manifests using carvel YTT tool
  #
  - include: [ "kubernetes/k8s/deployment.yaml", "kubernetes/k8s/service.yaml"]
    condition: "#generateK8sYAMLS == true"
    chain:
      - type: YTT
      - type: RewritePath
        rewriteTo: "'kubernetes/' + #filename"
  chain:
  - exclude: ["kubernetes/k8s/*"]
  